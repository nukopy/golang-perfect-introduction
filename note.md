# Gopher 道場

メモ書き

## chap01：Go に触れる

### Go とは

- Google が開発したプログラミング言語
- 特徴
  - 強力でシンプルな言語設計と文法
  - 並行プログラミング
  - 豊富な標準ライブラリ群
  - 周辺ツールの充実
  - シングルバイナリ・クロスコンパイル（OS、アーキテクチャを指定してコンパイルできる）

### Go が開発された背景

- **Google 内の課題を解決するために開発された**
  - 開発速度の低下
    - 超巨大なコードベース
    - 複雑な依存関係
  - マルチコア時代のシステム言語
    - 並行処理とガベージコレクタを同時に採用
  - 軽量プログラミング言語（LL、Light weight Language）の盛り上がり
    - 静的型付け言語だとコンパイル時にエラーが発見できる
    - 動的型付け言語だと書きやすい
    - 静的 / 動的型付け言語のいいところどりをした書きやすい静的型付け言語が Go
  - 静的解析がしやすい
    - 言語設計レベルで静的解析しやすい言語を目指した

### Go の特徴：概要

- 強力でシンプルな言語設計と文法
- 並行プログラミング
- 豊富な標準ライブラリ群
- 周辺ツールの充実
- シングルバイナリ・クロスコンパイル（OS、アーキテクチャを指定してコンパイルできる）

#### 強力でシンプルな言語設計と文法

- 強力でシンプルな言語設計と文法
  - スクリプト言語の書きやすさ
    - 冗長な記述は必要ない
  - 型のある言語の厳密さ
    - 曖昧な記述できない
  - 考えられたシンプルさ
    - 機能を増やすことで言語を拡張していくことはしない
    - 例えば、他の言語の良さそうな機能を Go にどんどん取り入れていくという文化ではない。できる限り言語設計はシンプルに保つ。

Go に入って Go に従え = 言語の思想を理解するのが大事

#### 並行プログラミング

- ゴールーチン
  - **軽量なスレッド**に近いもの（スレッドとは何が違うの？）
  - `go` キーワードを付けて関数呼び出し

```go
// 関数 f を別のゴールーチンで呼び出す
go f()
```

- チャネル
  - ゴールーチン間のデータのやり取り（スレッド間のデータのやり取りと同じ要領）
  - 安全にデータをやり取りできる

#### 豊富な標準ライブラリ

- 標準ライブラリ一覧
  - https://pkg.go.dev/std

| 標準ライブラリ名  | 内容、機能             |
| ----------------- | ---------------------- |
| fmt               | 書式、出力に関する処理 |
| net/http          | HTTP サーバなど        |
| archive, compress | zip や gzip など       |
| encoding          | JSON、XML、CSV など    |
| html/template     | HTML テンプレート      |
| os, path/filepath | ファイル操作など       |

#### 周辺ツールの充実

- `go tool` として標準 / 準標準で提供
- サードパーティ製のツールも充実
- IDE によらない独立したツールとして提供

| コマンド             | 内容、機能                            |
| -------------------- | ------------------------------------- |
| `go build`           | ビルドを行うコマンド                  |
| `go test`            | `xxxx_test.go`                        |
| `go doc`, `godoc`    | ドキュメント生成                      |
| `gofmt`, `goimports` | コードフォーマッタ                    |
| `go vet`             | コードチェッカー                      |
| `gopls`              | Language Server Protocol（LSP）の実装 |

#### シングルバイナリ・クロスコンパイル

- シングルバイナリになる
  - コンパイルするとデフォルトで単一の実行可能ファイルが生成される（C / C++ などと同じ）
  - 動作環境を特別に用意しなくてもよい（バイナリなので、インタプリタを必要とする言語と異なり、動作させる際に言語処理系が必要ない）
- クロスコンパイルできる
  - 開発環境とは違う OS やアーキテクチャ（CPU）向けのバイナリが作れる
  - 環境変数の `GOOS`（OS を指定）と `GOARCH`（アーキテクチャを指定）を指定する

```sh
# Windows(32 ビット)向けにコンパイル
$ GOOS=windows GOARCH=386 go build

# Linux(64 ビット)向けにコンパイル
$ GOOS=linux GOARCH=amd64 go build
```

`go build` は Go のソースコードをビルドするコマンド

### Go を学ぶ理由

- 多くのプロダクトで採用
  - https://github.com/golang/go/wiki/GoUsers#japan
- チーム開発に向いている
  - 静的型付け
  - 文法がシンプル
- パフォーマンスが良い
  - ゴールーチンとチャネル
  - バイナリになる（インタプリタを必要とする言語と異なり、動作させる際に言語処理系が必要ない）

### コンパイルと実行

- `go build` コマンド
  - コンパイルして実行可能ファイル（バイナリファイル）を生成

```sh
go build main.go
go build .
go build pkg_name
```

- `go run` コマンド
  - コンパイルから実行まで行う

```sh
go run main.go
go run .
go run pkg_name
```

### コーディングに必要なツール

#### コードの書式を揃える

- gofmt
  - 読み方:ごーふむと
  - 標準のフォーマッタ
  - **絶対に使う**
  - `-s` オプションで冗長な書き方をシンプルにできる
- goimports
  - `import` 文を追加 / 削除してくれる
  - 未使用パッケージ `import` コンパイルエラーなのでで必須
  - フォーマットもかける
  - `-s` オプションがない

#### 静的解析ツール

| ツール名      | 機能                                                               |
| ------------- | ------------------------------------------------------------------ |
| go vet        | バグと言えるレベルの誤りを検出（これで検出されるのはだいたいバグ） |
| golint        | （非推奨）Go らしくないコードを検出                                |
| errcheck      | エラー処理のミスを検出                                             |
| staticcheck   | サードパーティ製の静的解析ツール                                   |
| GolangCI-Lint | サードパーティ製の Linter Runner                                   |
| gosec         | セキュリティチェック                                               |

#### PR レビューで静的解析ツールを使用

- reviewdog
  - リポジトリ：https://github.com/reviewdog/reviewdog
  - レビュー時に自動で静的解析ツールを実行する
  - 機械的にチェックできることは機械にやらせる
  - 人間だと忘れたり、心苦しかったりしてチェックが漏れる
  - 設定ファイルを書けば reviewdog が勝手に PR にコメントをくれる

#### デバッグ

- GDB
  - リポジトリ：https://golang.org/doc/gdb
  - 有名な古き良きデバッガ
  - Go 自体にカスタマイズされてるわけではない。（Go 開発では使わない？）
- Delve
  - リポジトリ：https://github.com/derekparker/delve
  - Go 専用のデバッガでよく使われる
  - ゴールーチンやチャネルにも対応
- panic デバッグ
  - `panic` 関数を使ってデバッグ
  - スタックトレースが出るので便利
- print デバッグ

## 小休止

Go を Homebrew を用いてインストールし、VSCode の Go 拡張を入れてコードを書き始めようとしたら、Go 拡張に必要なツールが無くて怒られた。

以下、必要なツールのインストールコマンド。

```sh
# "gopls"（Language Server Protocol）
go get -v golang.org/x/tools/gopls

# "goimports"
go get -v golang.org/x/tools/cmd/goimports

# "go-outline"
go get -v github.com/ramya-rao-a/go-outline

# "gopkgs"
go get -v github.com/uudashr/gopkgs/v2/cmd/gopkgs
```

